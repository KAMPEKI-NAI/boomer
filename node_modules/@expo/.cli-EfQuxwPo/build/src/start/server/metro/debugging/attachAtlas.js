"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    attachAtlasAsync: function() {
        return attachAtlasAsync;
    },
    waitUntilAtlasExportIsReadyAsync: function() {
        return waitUntilAtlasExportIsReadyAsync;
    }
});
const _AtlasPrerequisite = require("./AtlasPrerequisite");
const _env = require("../../../../utils/env");
const debug = require('debug')('expo:metro:debugging:attachAtlas');
async function attachAtlasAsync(options) {
    if (!_env.env.EXPO_ATLAS) {
        return;
    }
    debug('Atlas is enabled, initializing for this project...');
    await new _AtlasPrerequisite.AtlasPrerequisite(options.projectRoot).bootstrapAsync({
        exp: options.exp
    });
    return !options.isExporting ? attachAtlasToDevServer(options) : await attachAtlasToExport(options);
}
/**
 * Attach Atlas to the Metro bundler for development mode.
 * This includes attaching to Metro's middleware stack to host the Atlas UI.
 */ function attachAtlasToDevServer(options) {
    if (!options.middleware) {
        throw new Error('Expected middleware to be provided for Atlas when running in development mode');
    }
    const atlas = importAtlasForDev(